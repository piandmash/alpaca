/*! alpaca - v0.1.0 - Copyright (c) 2013 */
!function($){var Alpaca;Alpaca=function(){var args=Alpaca.makeArray(arguments);if(0===args.length)return Alpaca.throwDefaultError("You must supply at least one argument which is the element against which to apply the Alpaca generated form");var el=args[0],data=null,schema=null,options=null,view=null,callback=null,renderedCallback=null,errorCallback=null,connector=null,notTopLevel=!1,isDynamicCreation=!1,initialSettings={},dataSource=null,schemaSource=null,optionsSource=null,viewSource=null;if(1==args.length){for(var domElements=$(el).find(":first"),field=null,i=0;i<domElements.length;i++){var domElement=domElements[i],fieldId=$(domElement).attr("alpaca-field-id");if(fieldId){var _field=Alpaca.fieldInstances[fieldId];_field&&(field=_field)}}if(null!==field)return field;var domData=$(el).html();$(el).html(""),data=domData}if(args.length>=2&&(Alpaca.isObject(args[1])?(data=args[1].data,schema=args[1].schema,options=args[1].options,view=args[1].view,callback=args[1].render,renderedCallback=args[1].postRender,errorCallback=args[1].error,connector=args[1].connector,dataSource=args[1].dataSource,schemaSource=args[1].schemaSource,optionsSource=args[1].optionsSource,viewSource=args[1].viewSource,args[1].ui&&(initialSettings.ui=args[1].ui),args[1].type&&(initialSettings.type=args[1].type),Alpaca.isEmpty(args[1].notTopLevel)||(notTopLevel=args[1].notTopLevel),Alpaca.isEmpty(args[1].isDynamicCreation)||(isDynamicCreation=args[1].isDynamicCreation)):(data=args[1],Alpaca.isFunction(data)&&(data=data()))),Alpaca.isEmpty(errorCallback)&&(errorCallback=Alpaca.defaultErrorCallback),Alpaca.isEmpty(connector)){var connectorClass=Alpaca.getConnectorClass("default");connector=new connectorClass("default")}el&&Alpaca.isString(el)&&(el=$("#"+el));var loadAllConnector=connector;if(notTopLevel){var loadAllConnectorClass=Alpaca.getConnectorClass("default");loadAllConnector=new loadAllConnectorClass("default")}options||(options={}),Alpaca.isUndefined(options.focus)&&(options.focus=!1);var _renderedCallback=function(control){if(options&&options.focus)if(options.focus===!0)control.children&&control.children.length>0&&control.children[0].field&&control.children[0].field[0]&&$(control.children[0]).focus();else{var child=control.getControlByPath(options.focus);child&&child.field&&$(child).focus()}renderedCallback&&renderedCallback(control)};return loadAllConnector.loadAll({data:data,schema:schema,options:options,view:view,dataSource:dataSource,schemaSource:schemaSource,optionsSource:optionsSource,viewSource:viewSource},function(loadedData,loadedOptions,loadedSchema,loadedView){return loadedData=loadedData?loadedData:data,loadedSchema=loadedSchema?loadedSchema:schema,loadedOptions=loadedOptions?loadedOptions:options,loadedView=loadedView?loadedView:view,Alpaca.isEmpty(loadedData)&&Alpaca.isEmpty(loadedSchema)&&(Alpaca.isEmpty(loadedOptions)||Alpaca.isEmpty(loadedOptions.type))&&(loadedData="",Alpaca.isEmpty(loadedOptions)?loadedOptions="text":options&&Alpaca.isObject(options)&&(loadedOptions.type="text")),Alpaca.init(el,loadedData,loadedOptions,loadedSchema,loadedView,initialSettings,callback,_renderedCallback,connector,errorCallback,isDynamicCreation)},function(loadError){return errorCallback(loadError),null}),$(el)},Alpaca.Fields={},Alpaca.Connectors={},$.extend(Alpaca,{VERSION:"0.1.0",makeArray:function(nonArray){return Array.prototype.slice.call(nonArray)},isFunction:function(obj){return"[object Function]"===Object.prototype.toString.call(obj)},isString:function(obj){return"string"==typeof obj},isObject:function(obj){return obj===!0||obj===!1||Alpaca.isUndefined(obj)||null===obj?!1:"object"==typeof obj&&"undefined"==typeof obj.length},isPlainObject:function(obj){return $.isPlainObject(obj)},isNumber:function(obj){return"number"==typeof obj},isArray:function(obj){return obj===!0||obj===!1||Alpaca.isUndefined(obj)||null===obj?!1:obj.push&&obj.slice},isBoolean:function(obj){return"boolean"==typeof obj},isUndefined:function(obj){return"undefined"==typeof obj},trim:function(text){var trimmed=text;return trimmed&&Alpaca.isString(trimmed)&&(trimmed=trimmed.replace(/^\s+|\s+$/g,"")),trimmed},safeDomParse:function(x){return x&&Alpaca.isString(x)&&(x=Alpaca.trim(x),x=$(x)),x},isEmpty:function(obj){return Alpaca.isUndefined(obj)||null===obj},copyOf:function(thing){var copy=thing;if(Alpaca.isArray(thing)){copy=[];for(var i=0;i<thing.length;i++)copy.push(Alpaca.copyOf(thing[i]))}else if(Alpaca.isObject(thing)){if(thing instanceof Date)return new Date(thing.getTime());if(thing instanceof RegExp)return new RegExp(thing);if(thing.nodeType&&"cloneNode"in thing)copy=thing.cloneNode(!0);else if($.isPlainObject(thing)){copy={};for(var k in thing)thing.hasOwnProperty(k)&&(copy[k]=Alpaca.copyOf(thing[k]))}}return copy},cloneObject:function(object){return Alpaca.copyOf(object)},spliceIn:function(source,splicePoint,splice){return source.substring(0,splicePoint)+splice+source.substring(splicePoint,source.length)},compactArray:function(arr){var i,n=[],l=arr.length;for(i=0;l>i;i++)lang.isNull(arr[i])||lang.isUndefined(arr[i])||n.push(arr[i]);return n},removeAccents:function(str){return str.replace(/[àáâãäå]/g,"a").replace(/[èéêë]/g,"e").replace(/[ìíîï]/g,"i").replace(/[òóôõö]/g,"o").replace(/[ùúûü]/g,"u").replace(/[ýÿ]/g,"y").replace(/[ñ]/g,"n").replace(/[ç]/g,"c").replace(/[œ]/g,"oe").replace(/[æ]/g,"ae")},indexOf:function(el,arr,fn){var i,l=arr.length;for(Alpaca.isFunction(fn)||(fn=function(elt,arrElt){return elt===arrElt}),i=0;l>i;i++)if(fn.call({},el,arr[i]))return i;return-1},uniqueIdCounter:0,defaultLocale:"en_US",setDefaultLocale:function(locale){this.defaultLocale=locale},defaultSchemaFieldMapping:{},registerDefaultSchemaFieldMapping:function(schemaType,fieldType){schemaType&&fieldType&&(this.defaultSchemaFieldMapping[schemaType]=fieldType)},defaultFormatFieldMapping:{},registerDefaultFormatFieldMapping:function(format,fieldType){format&&fieldType&&(this.defaultFormatFieldMapping[format]=fieldType)},getSchemaType:function(data){return Alpaca.isEmpty(data)?"string":Alpaca.isObject(data)?"object":Alpaca.isString(data)?"string":Alpaca.isNumber(data)?"number":Alpaca.isArray(data)?"array":Alpaca.isBoolean(data)?"boolean":"object"==typeof data?"object":void 0},views:{},viewIdPrefix:"VIEW_",isValidViewId:function(id){return Alpaca.startsWith(id,this.viewIdPrefix)},generateViewId:function(){return this.viewIdPrefix+this.generateId()},registerView:function(viewObject){var id=viewObject.id;if(!id)return Alpaca.throwDefaultError("Cannot register view with missing view id: "+id);var existingView=this.views[id];existingView?Alpaca.mergeObject(existingView,viewObject):this.views[id]=viewObject},defaultView:"VIEW_WEB_EDIT",setDefaultView:function(viewId){viewId&&this.views.hasOwnProperty(viewId)&&(this.defaultView=viewId)},getNormalizedView:function(viewId){return this.normalizedViews[viewId]},lookupNormalizedView:function(ui,type){var theViewId=null;for(var viewId in this.normalizedViews){var view=this.normalizedViews[viewId];if(view.ui==ui&&view.type==type){theViewId=viewId;break}}return theViewId},registerTemplate:function(templateId,template,viewId){viewId||(viewId="VIEW_BASE"),this.views[viewId]||(this.views[viewId]={},this.views[viewId].id=viewId),this.views[viewId].templates||(this.views[viewId].templates={}),this.views[viewId].templates[templateId]=template},registerTemplates:function(templates,viewId){for(var templateId in templates)this.registerTemplate(templateId,templates[templateId],viewId)},registerMessage:function(messageId,message,viewId){viewId||(viewId="VIEW_BASE"),this.views[viewId]||(this.views[viewId]={},this.views[viewId].id=viewId),this.views[viewId].messages||(this.views[viewId].messages={}),this.views[viewId].messages[messageId]=message},registerMessages:function(messages,viewId){for(var messageId in messages)messages.hasOwnProperty(messageId)&&this.registerMessage(messageId,messages[messageId],viewId)},fieldTemplatePostfix:{controlFieldMessageContainer:"-controlfield-message-container",controlFieldLabel:"-controlfield-label",controlFieldContainer:"-controlfield-container",controlFieldHelper:"-controlfield-helper",fieldSetLegend:"-fieldset-legend",fieldSetItemsContainer:"-fieldset-items-container",fieldSetHelper:"-fieldset-helper",fieldSetOuterEl:"-fieldset",formButtonsContainer:"-form-buttons-container",formFieldsContainer:"-form-fields-container"},fieldTemplate:function(object,name,wrap){var field=object.data,view=object.data.view,html="";name||(name="controlFieldLabel");var templateDescriptor=this.getTemplateDescriptor(view,name,field);if(wrap){var template=templateDescriptor.template.value;0===$(".alpaca"+this.fieldTemplatePostfix[name],Alpaca.safeDomParse(template)).length&&this.fieldTemplatePostfix[name]&&(template=Alpaca.safeDomParse(template).addClass("alpaca"+this.fieldTemplatePostfix[name])),html=Alpaca.safeDomParse(template).outerHTML(!0)}else{var label=view.tmpl(templateDescriptor,object.data);label?(this.fieldTemplatePostfix[name]&&(0===$(".alpaca"+this.fieldTemplatePostfix[name],label).length&&label.addClass("alpaca"+this.fieldTemplatePostfix[name]),label.attr("id")||label.attr("id",object.data.id+this.fieldTemplatePostfix[name])),html=label.outerHTML(!0)):html=""}return html},defaultDateFormat:"mm/dd/yy",regexps:{email:/^[a-z0-9!\#\$%&'\*\-\/=\?\+\-\^_`\{\|\}~]+(?:\.[a-z0-9!\#\$%&'\*\-\/=\?\+\-\^_`\{\|\}~]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z]{2,6}$/i,url:/^(http|https):\/\/[a-z0-9]+([\-\.]{1}[a-z0-9]+)*\.[a-z]{2,5}(\:[0-9]{1,5})?(([0-9]{1,5})?\/.*)?$/i,password:/^[0-9a-zA-Z\x20-\x7E]*$/,date:/^(0[1-9]|1[012])[- /.](0[1-9]|[12][0-9]|3[01])[- /.]\d\d$/,integer:/^([\+\-]?([1-9]\d*)|0)$/,number:/^([\+\-]?((([0-9]+(\.)?)|([0-9]*\.[0-9]+))([eE][+-]?[0-9]+)?))$/,phone:/^(\D?(\d{3})\D?\D?(\d{3})\D?(\d{4}))?$/,ipv4:/^(?:1\d?\d?|2(?:[0-4]\d?|[6789]|5[0-5]?)?|[3-9]\d?|0)(?:\.(?:1\d?\d?|2(?:[0-4]\d?|[6789]|5[0-5]?)?|[3-9]\d?|0)){3}$/,"zipcode-five":/^(\d{5})?$/,"zipcode-nine":/^(\d{5}(-\d{4})?)?$/},fieldInstances:{},fieldClassRegistry:{},registerFieldClass:function(type,fieldClass){this.fieldClassRegistry[type]=fieldClass},getFieldClass:function(type){return this.fieldClassRegistry[type]},getFieldClassType:function(fieldClass){for(var type in this.fieldClassRegistry)if(this.fieldClassRegistry.hasOwnProperty(type)&&this.fieldClassRegistry[type]==fieldClass)return type;return null},connectorClassRegistry:{},registerConnectorClass:function(type,connectorClass){this.connectorClassRegistry[type]=connectorClass},getConnectorClass:function(type){return this.connectorClassRegistry[type]},replaceAll:function(text,replace,with_this){return text.replace(new RegExp(replace,"g"),with_this)},element:function(tag,domAttributes,styleAttributes,classNames){var el=$("<"+tag+"/>");if(domAttributes&&el.attr(domAttributes),styleAttributes&&el.css(styleAttributes),classNames)for(var className in classNames)el.addClass(className)},elementFromTemplate:function(template,substitutions){var html=template;if(substitutions)for(var x in substitutions)html=Alpaca.replaceAll(html,"${"+x+"}",substitutions[x]);return $(html)},generateId:function(){return Alpaca.uniqueIdCounter++,"alpaca"+Alpaca.uniqueIdCounter},later:function(when,o,fn,data,periodic){when=when||0,o=o||{};var f,r,m=fn,d=$.makeArray(data);if("string"==typeof fn&&(m=o[fn]),!m)throw{name:"TypeError",message:"The function is undefined."};return f=function(){m.apply(o,d)},r=periodic?setInterval(f,when):setTimeout(f,when),{id:r,interval:periodic,cancel:function(){this.interval?clearInterval(r):clearTimeout(r)}}},endsWith:function(text,suffix){return-1!==text.indexOf(suffix,text.length-suffix.length)},startsWith:function(text,prefix){return text.substr(0,prefix.length)===prefix},isUri:function(obj){return Alpaca.isString(obj)&&(Alpaca.startsWith(obj,"http://")||Alpaca.startsWith(obj,"https://")||Alpaca.startsWith(obj,"/")||Alpaca.startsWith(obj,"./")||Alpaca.startsWith(obj,"../"))},traverseObject:function(object,keys,subprop){Alpaca.isString(keys)&&(keys=keys.split("."));var element=null,current=object,key=null;do key=keys.shift(),subprop&&key==subprop&&(key=keys.shift()),Alpaca.isEmpty(current[key])?keys=[]:(current=current[key],0===keys.length&&(element=current));while(keys.length>0);return element},each:function(data,func){if(Alpaca.isArray(data))for(var i=0;i<data.length;i++)func.apply(data[i]);else if(Alpaca.isObject(data))for(var key in data)func.apply(data[key])},merge:function(obj1,obj2,validKeyFunction){obj1||(obj1={});for(var key in obj2){var valid=!0;validKeyFunction&&(valid=validKeyFunction(key)),valid&&(Alpaca.isEmpty(obj2[key])?obj1[key]=obj2[key]:Alpaca.isObject(obj2[key])?(obj1[key]||(obj1[key]={}),obj1[key]=Alpaca.merge(obj1[key],obj2[key])):obj1[key]=obj2[key])}return obj1},mergeObject:function(target,source){return target||(target={}),source||(source={}),this.mergeObject2(source,target),target},mergeObject2:function(source,target){var isArray=Alpaca.isArray,isObject=Alpaca.isObject,isUndefined=Alpaca.isUndefined,copyOf=Alpaca.copyOf,_merge=function(source,target){return isArray(source)?isArray(target)&&$.each(source,function(index){target.push(copyOf(source[index]))}):isObject(source)?isObject(target)&&$.each(source,function(key){target[key]=isUndefined(target[key])?copyOf(source[key]):_merge(source[key],target[key])}):target=copyOf(source),target};return _merge(source,target),target},substituteTokens:function(text,args){if(!Alpaca.isEmpty(text))for(var i=0;i<args.length;i++){var token="{"+i+"}",x=text.indexOf(token);if(x>-1){var nt=text.substring(0,x)+args[i]+text.substring(x+3);text=nt}}return text},compareObject:function(obj1,obj2){return equiv(obj1,obj2)},compareArrayContent:function(arr_1,arr_2){var equal=arr_1&&arr_2&&arr_1.length==arr_2.length;return equal&&$.each(arr_1,function(foo,val){return equal?(equal=-1==$.inArray(val,arr_2)?!1:!0,void 0):!1}),equal},isValEmpty:function(val){var empty=!1;return Alpaca.isEmpty(val)?empty=!0:(Alpaca.isString(val)&&""===val&&(empty=!0),Alpaca.isObject(val)&&$.isEmptyObject(val)&&(empty=!0),Alpaca.isArray(val)&&0===val.length&&(empty=!0),Alpaca.isNumber(val)&&isNaN(val)&&(empty=!0)),empty},init:function(el,data,options,schema,view,initialSettings,callback,renderedCallback,connector,errorCallback,isDynamicCreation){var self=this;if(Alpaca.isObject(view)){var viewId=view.id;viewId||(view.id=this.generateViewId());var parentId=view.parent;parentId||(view.parent="VIEW_WEB_EDIT"),this.registerView(view),view=view.id}this.compile(function(report){if(report.errors&&report.errors.length>0){for(var i=0;i<report.errors.length;i++){var viewId=report.errors[i].viewId,templateId=report.errors[i].templateId,err=report.errors[i].err;Alpaca.logError("The template: "+templateId+" for view: "+viewId+" failed to compile"),Alpaca.logError(JSON.stringify(err))}return Alpaca.throwErrorWithCallback("View compilation failed, cannot initialize Alpaca.  Please check the error logs.",errorCallback)}self._init(el,data,options,schema,view,initialSettings,callback,renderedCallback,connector,errorCallback,isDynamicCreation)},errorCallback)},_init:function(el,data,options,schema,view,initialSettings,callback,renderedCallback,connector,errorCallback,isDynamicCreation){var fallbackUI=null,fallbackType=null,fallbackViewId=null;$.mobile&&(fallbackUI="mobile",data?(fallbackType="edit",fallbackViewId="VIEW_MOBILE_EDIT"):(fallbackType="create",fallbackViewId="VIEW_MOBILE_CREATE"));var bootstrapDetected="function"==typeof $().modal;if(bootstrapDetected&&(fallbackUI="bootstrap",data?(fallbackType="edit",fallbackViewId="VIEW_BOOTSTRAP_EDIT"):(fallbackType="create",fallbackViewId="VIEW_BOOTSTRAP_CREATE")),!view){var ui=initialSettings.ui,type=initialSettings.type;ui||(fallbackUI||(fallbackUI=Alpaca.defaultUI),fallbackUI&&(ui=fallbackUI)),ui&&(type||(type=fallbackType?fallbackType:"edit"),Alpaca.logDebug("No view provided but found request for UI: "+ui+" and type: "+type),view=this.lookupNormalizedView(ui,type),view?Alpaca.logDebug("Found view: "+view):Alpaca.logDebug("No view found for UI: "+ui+" and type: "+type))}if(view||(Alpaca.logDebug("A view was not specified."),fallbackViewId?(Alpaca.logDebug("Falling back to detected view: "+fallbackViewId),view=fallbackViewId):(Alpaca.logDebug("Falling back to default view: "+this.defaultView),view=this.defaultView)),Alpaca.isString(view)&&!this.normalizedViews[view])return Alpaca.throwErrorWithCallback("The desired view: "+view+" could not be loaded.  Please make sure it is loaded and not misspelled.",errorCallback);var field=Alpaca.createFieldInstance(el,data,options,schema,view,connector,errorCallback);if(field){if(field.isDynamicCreation=isDynamicCreation,Alpaca.fieldInstances[field.getId()]=field,field.allFieldInstances=function(){return Alpaca.fieldInstances},Alpaca.isEmpty(callback)&&(callback=field.view.render),Alpaca.isEmpty(renderedCallback)&&(renderedCallback=field.view.postRender),Alpaca.collectTiming)var counters=Alpaca.Counters("render"),t1=(new Date).getTime();var fin=function(){if(Alpaca.collectTiming){var t2=(new Date).getTime();counters.increment(field.getFieldType(),t2-t1)}renderedCallback(field)};Alpaca.isEmpty(callback)?field.render(function(){fin()}):callback(field,function(){fin()}),field.callback=callback,field.renderedCallback=renderedCallback}return field},createFieldInstance:function(el,data,options,schema,view,connector,errorCallback){if(Alpaca.isValEmpty(options)&&(options={}),Alpaca.isValEmpty(schema)&&(schema={}),options&&Alpaca.isString(options)){var fieldType=options;options={},options.type=fieldType}options.type||(schema.type||(schema.type=Alpaca.getSchemaType(data)),options.type=schema&&schema["enum"]?schema["enum"].length>3?"select":"radio":Alpaca.defaultSchemaFieldMapping[schema.type],schema.format&&Alpaca.defaultFormatFieldMapping[schema.format]&&(options.type=Alpaca.defaultFormatFieldMapping[schema.format]));var fieldClass=Alpaca.getFieldClass(options.type);return fieldClass?new fieldClass(el,data,options,schema,view,connector,errorCallback):(errorCallback({message:"Unable to find field class for type: "+options.type,reason:"FIELD_INSTANTIATION_ERROR"}),null)},parseJSON:function(text){return text?$.parseJSON(text):null},compile:function(cb,errorCallback){var self=this,report={errors:[],count:0,successCount:0},finalCallback=function(normalizedViews){if(0===report.errors.length)for(var k in normalizedViews)self.normalizedViews[k]=normalizedViews[k];cb(report)},viewCompileCallback=function(normalizedViews,err,view,compiledTemplateId,cacheKey,totalCalls){var viewId=view.id;report.count++,err?report.errors.push({view:viewId,template:compiledTemplateId,err:err}):(report.successCount++,view.compiledTemplates[compiledTemplateId]=cacheKey),report.count==totalCalls&&finalCallback(normalizedViews)},compileViewTemplate=function(normalizedViews,view,compiledTemplateId,template,totalCalls){var viewId=view.id,mightBeUrl=template&&template.indexOf("/")>-1;if(mightBeUrl);else if(template&&(0===template.indexOf("#")||0===template.indexOf("."))){var x=$(template);type=$(x).attr("type"),template=$(x).html()}var type=null;Alpaca.isObject(template)&&(type=template.type,template=template.template),type||(type="text/x-jquery-tmpl");var engine=Alpaca.TemplateEngineRegistry.find(type);if(!engine){Alpaca.logError("Cannot find template engine for type: "+type);var err=new Error("Cannot find template engine for type: "+type);viewCompileCallback(normalizedViews,err,view,compiledTemplateId,cacheKey,totalCalls)}var cacheKey=viewId+"_"+compiledTemplateId;if(engine.isCached(cacheKey))viewCompileCallback(normalizedViews,null,view,compiledTemplateId,cacheKey,totalCalls);else{var previouslyCompiledTemplateCacheKey=view.compiledTemplates["view-"+template];previouslyCompiledTemplateCacheKey&&(template=Alpaca.TemplateCache[previouslyCompiledTemplateCacheKey]),engine.compile(cacheKey,template,function(err){viewCompileCallback(normalizedViews,err,view,compiledTemplateId,cacheKey,totalCalls)})}},compileTemplates=function(normalizedViews){var functionArray=[];for(var viewId in normalizedViews){var view=normalizedViews[viewId];if(view.compiledTemplates={},view.templates)for(var templateId in view.templates){var template=view.templates[templateId];functionArray.push(function(normalizedViews,view,compiledTemplateId,template){return function(totalCalls){compileViewTemplate(normalizedViews,view,compiledTemplateId,template,totalCalls)}}(normalizedViews,view,"view-"+templateId,template))}if(view.fields)for(var path in view.fields)if(view.fields[path].templates)for(var templateId in view.fields[path].templates){var template=view.fields[path].templates[templateId];functionArray.push(function(normalizedViews,view,compiledTemplateId,template){return function(totalCalls){compileViewTemplate(normalizedViews,view,compiledTemplateId,template,totalCalls)}}(normalizedViews,view,"field-"+path+"-"+templateId,template))}if(view.layout&&view.layout.template){var template=view.layout.template;functionArray.push(function(normalizedViews,view,compiledTemplateId,template){return function(totalCalls){compileViewTemplate(normalizedViews,view,compiledTemplateId,template,totalCalls)}}(normalizedViews,view,"layoutTemplate",template))}if(view.globalTemplate){var template=view.globalTemplate;functionArray.push(function(normalizedViews,view,compiledTemplateId,template){return function(totalCalls){compileViewTemplate(normalizedViews,view,compiledTemplateId,template,totalCalls)}}(normalizedViews,view,"globalTemplate",template))}}for(var totalCalls=functionArray.length,i=0;i<functionArray.length;i++)functionArray[i](totalCalls)},normalizeViews=function(){var normalizedViews={},normalizedViewCount=0;Alpaca.normalizedViews||(Alpaca.normalizedViews={}),self.normalizedViews=Alpaca.normalizedViews;for(var viewId in self.views)if(!Alpaca.normalizedViews[viewId]){var normalizedView=new Alpaca.NormalizedView(viewId);if(!normalizedView.normalize())return Alpaca.throwErrorWithCallback("View normalization failed, cannot initialize Alpaca.  Please check the error logs.",errorCallback);normalizedViews[viewId]=normalizedView,normalizedViewCount++}normalizedViewCount>0?compileTemplates(normalizedViews):finalCallback(normalizedViews)};normalizeViews()},getTemplateDescriptor:function(view,templateId,field){var _template,_templateType,descriptor={};if(view.templates&&view.templates[templateId]&&(_template=view.templates[templateId],_templateType="view"),field&&field.path){var path=field.path;view&&view.fields&&view.fields[path]&&view.fields[path].templates&&view.fields[path].templates[templateId]&&(_template=view.fields[path].templates[templateId],_templateType="field")}"globalTemplate"==templateId&&(_template="globalTemplate",_templateType="global"),"layoutTemplate"==templateId&&(_template="layoutTemplate",_templateType="layout"),descriptor.template={},descriptor.template.id=templateId,descriptor.template.type=_templateType,descriptor.template.value=_template;var type=null,template=_template;Alpaca.isObject(template)&&(type=template.type,template=template.template),type||(type="text/x-jquery-tmpl");var engine=Alpaca.TemplateEngineRegistry.find(type);if(!engine)return Alpaca.throwDefaultError("Cannot find template engine for type: "+type);descriptor.engine={},descriptor.engine.type=type,descriptor.engine.id=engine.id;var compiledTemplateId=null;"view"==_templateType?compiledTemplateId="view-"+templateId:"field"==_templateType?compiledTemplateId="field-"+field.path+"-"+templateId:"layout"==_templateType?compiledTemplateId="layoutTemplate":"global"==_templateType&&(compiledTemplateId="globalTemplate"),descriptor.compiledTemplateId=compiledTemplateId;var cacheKey=view.compiledTemplates[compiledTemplateId];return cacheKey&&engine.isCached(cacheKey)?(descriptor.cache={},descriptor.cache.key=cacheKey,descriptor):null},tmpl:function(view,templateDescriptor,model){Alpaca.isString(view)&&(view=this.normalizedViews[view]);var engineType=templateDescriptor.engine.type,compiledTemplateId=templateDescriptor.compiledTemplateId,engine=Alpaca.TemplateEngineRegistry.find(engineType);if(!engine)return Alpaca.throwDefaultError("Cannot find template engine for type: "+engineType);var cacheKey=templateDescriptor.cache.key,html=engine.execute(cacheKey,model,function(err){return Alpaca.throwDefaultError("The compiled template: "+compiledTemplateId+" for view: "+view.id+" failed to execute: "+JSON.stringify(err))});return Alpaca.safeDomParse(html)}}),Alpaca.DEBUG=0,Alpaca.INFO=1,Alpaca.WARN=2,Alpaca.ERROR=3,Alpaca.logLevel=Alpaca.WARN,Alpaca.logDebug=function(obj){Alpaca.log(Alpaca.DEBUG,obj)},Alpaca.logInfo=function(obj){Alpaca.log(Alpaca.INFO,obj)},Alpaca.logWarn=function(obj){Alpaca.log(Alpaca.WARN,obj)},Alpaca.logError=function(obj){Alpaca.log(Alpaca.ERROR,obj)},Alpaca.LOG_METHOD_MAP={0:"debug",1:"info",2:"warn",3:"error"},Alpaca.log=function(level,obj){if(Alpaca.logLevel<=level){var method=Alpaca.LOG_METHOD_MAP[level];"undefined"!=typeof console&&console[method]&&("debug"==method?console.debug(obj):"info"==method?console.info(obj):"warn"==method?console.warn(obj):"error"==method?console.error(obj):console.log(obj))}},Alpaca.checked=function(el,value){return Alpaca.attrProp(el,"checked",value)},Alpaca.attrProp=function(el,name,value){return"undefined"!=typeof value&&($(el).prop?$(el).prop(name,value):value?$(el).attr(name,value):$(el).removeAttr(name)),$(el).prop?$(el).prop(name):$(el).attr(name)},Alpaca.loadRefSchemaOptions=function(topField,referenceId,callback){if(referenceId.indexOf("#/definitions/")>-1){var defId=referenceId.substring(14),defSchema=null;topField.schema.definitions&&(defSchema=topField.schema.definitions[defId]);var defOptions=null;topField.options.definitions&&(defOptions=topField.options.definitions[defId]),callback(defSchema,defOptions)}else{var resolution=Alpaca.resolveReference(topField.schema,topField.options,referenceId);resolution?callback(resolution.schema,resolution.options):callback()}},Alpaca.DEFAULT_ERROR_CALLBACK=function(error){if(error&&error.message)throw Alpaca.logError(error.message),new Error("Alpaca caught an error with the default error handler: "+error.message)},Alpaca.defaultErrorCallback=Alpaca.DEFAULT_ERROR_CALLBACK,Alpaca.throwDefaultError=function(message){message&&Alpaca.isObject(message)&&(message=JSON.stringify(message));var err={message:message};Alpaca.defaultErrorCallback(err)},Alpaca.throwErrorWithCallback=function(message,errorCallback){message&&Alpaca.isObject(message)&&(message=JSON.stringify(message));var err={message:message};errorCallback?errorCallback(err):Alpaca.defaultErrorCallback(err)},Alpaca.resolveReference=function(schema,options,referenceId){if(schema.id==referenceId){var result={};return schema&&(result.schema=schema),options&&(result.options=options),result}if(schema&&schema.properties)for(var propertyId in schema.properties){var subSchema=schema.properties[propertyId],subOptions=null;options&&options.fields&&options.fields[propertyId]&&(subOptions=options.fields[propertyId]);var x=Alpaca.resolveReference(subSchema,subOptions,referenceId);if(x)return x}return null},$.alpaca=window.Alpaca=Alpaca,$.fn.alpaca=function(){var args=Alpaca.makeArray(arguments),newArgs=[].concat(this,args);return Alpaca.apply(this,newArgs)},$.fn.outerHTML=function(nocloning){return nocloning?$("<div></div>").append(this).html():$("<div></div>").append(this.clone()).html()},$.fn.swapWith=function(to){return this.each(function(){var copy_to=$(to).clone(),copy_from=$(this).clone();$(to).replaceWith(copy_from),$(this).replaceWith(copy_to)})},$.fn.attrProp=function(name,value){return Alpaca.attrProp($(this),name,value)},$.event.special.destroyed={remove:function(o){o.handler&&o.handler()}},Alpaca.CountersMap={},Alpaca.Counters=function(name){if(Alpaca.Counters[name])return Alpaca.Counters[name];var types={},all={count:0,total:0,avg:0,touches:0},counters={increment:function(type,amount){types[type]||(types[type]={count:0,total:0,avg:0,touches:0}),types[type].count++,types[type].total+=amount,types[type].avg=types[type].total/types[type].count,types[type].touches++,all.count++,all.total+=amount,all.avg=all.total/all.count,all.touches++},read:function(type){return types[type]},each:function(f){for(var type in types)f(type,types[type])},all:function(){return all}};return Alpaca.Counters[name]=counters,counters},Alpaca.collectTiming=!1}(jQuery);